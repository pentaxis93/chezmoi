{{- /*
Ultra-Zen Alacritty Keybinding Template
Generates Alacritty [[keyboard.bindings]] TOML blocks from semantic definitions

Usage:
  {{ template "keybind-alacritty.tmpl" dict "category" "navigate" "action" "file_end" "alacritty_action" "Last" "mode" "Vi" "comment" "Helix ge (go end)" "keybindings" $kb }}
  {{ template "keybind-alacritty.tmpl" dict "category" "discover" "action" "search_forward" "alacritty_action" "SearchForward" "mode" "Vi" "keybindings" $kb }}

Parameters:
  category: Semantic category (navigate, discover, transform)
  action: Specific action within category
  alacritty_action: Alacritty's action name
  mode: (optional) Alacritty mode (Vi, ~Vi, etc.)
  mods: (optional) Modifiers (Control|Shift, Shift, etc.)
  comment: (optional) Semantic comment
  keybindings: The keybindings data structure

Example Output:
  [[keyboard.bindings]]
  key = "E"
  mode = "Vi"
  action = "Last"  # Helix ge (go end) - semantic navigate.file_end
*/ -}}
{{- $category := .category -}}
{{- $action := .action -}}
{{- $alacrittyAction := .alacritty_action -}}
{{- $mode := "" -}}
{{- if hasKey . "mode" -}}
    {{- $mode = .mode -}}
{{- end -}}
{{- $mods := "" -}}
{{- if hasKey . "mods" -}}
    {{- $mods = .mods -}}
{{- end -}}
{{- $comment := "" -}}
{{- if hasKey . "comment" -}}
    {{- $comment = .comment -}}
{{- end -}}
{{- $kb := .keybindings -}}

{{- /* Get semantic key based on category and action */ -}}
{{- /* Initialize key and potential mods override */ -}}
{{- $key := "" -}}
{{- $modsOverride := "" -}}

{{- if eq $category "navigate" -}}
    {{- if eq $action "file_end" -}}
        {{- $key = "E" -}}  {{- /* Alacritty uses E for ge */ -}}
    {{- else if eq $action "file_start" -}}
        {{- $key = "G" -}}  {{- /* gg in vi mode */ -}}
    {{- end -}}
{{- else if eq $category "discover" -}}
    {{- if eq $action "search_forward" -}}
        {{- $key = "Slash" -}}
    {{- else if eq $action "search_backward" -}}
        {{- $key = "Slash" -}}
        {{- $modsOverride = "Shift" -}}
    {{- else if eq $action "search_next" -}}
        {{- $key = "N" -}}
    {{- else if eq $action "search_prev" -}}
        {{- $key = "N" -}}
        {{- $modsOverride = "Shift" -}}
    {{- end -}}
{{- else if eq $category "transform" -}}
    {{- if eq $action "mode_toggle" -}}
        {{- $key = "Space" -}}
        {{- $modsOverride = "Control|Shift" -}}
    {{- else if eq $action "clear_selection" -}}
        {{- $key = "C" -}}
        {{- $modsOverride = "Control|Shift" -}}
    {{- end -}}
{{- end -}}

{{- /* Apply mods override if set */ -}}
{{- if $modsOverride -}}
    {{- $mods = $modsOverride -}}
{{- end -}}

{{- /* Output the TOML binding block */ -}}
[[keyboard.bindings]]
key = "{{ $key }}"
{{- if $mods }}
mods = "{{ $mods }}"
{{- end }}
{{- if $mode }}
mode = "{{ $mode }}"
{{- end }}
action = "{{ $alacrittyAction }}"{{ if $comment }}  # {{ $comment }} - semantic {{ $category }}.{{ $action }}{{ end }}

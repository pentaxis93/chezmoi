{{- $theme := .themes.kanagawa.dragon -}}
{{- $s := .semantic -}}
# Qutebrowser Configuration - Ultra-Zen Web Navigation
# "The keyboard becomes the interface; intention becomes action"
#
# Theme-agnostic semantic colors with Helix-native keybindings
# Following our semantic navigation philosophy

# =============================================================================
# SEMANTIC COLOR HELPERS
# =============================================================================
# Define semantic colors for easy reference throughout config

# Surface colors (backgrounds, containers)
surface_primary = '#{{ index $theme $s.surface.primary }}'
surface_elevated = '#{{ index $theme $s.surface.elevated }}'
surface_subtle = '#{{ index $theme $s.surface.subtle }}'

# Text colors
text_primary = '#{{ index $theme $s.text.primary }}'
text_secondary = '#{{ index $theme $s.text.secondary }}'
text_emphasis = '#{{ index $theme $s.text.emphasis }}'
text_inverted = '#{{ index $theme $s.text.inverted }}'
text_disabled = '#{{ index $theme $s.text.disabled }}'

# State colors
state_error = '#{{ index $theme $s.state.error }}'
state_warning = '#{{ index $theme $s.state.warning }}'
state_success = '#{{ index $theme $s.state.success }}'
state_info = '#{{ index $theme $s.state.info }}'

# Interactive colors
interactive_focus = '#{{ index $theme $s.interactive.focus }}'
interactive_active = '#{{ index $theme $s.interactive.active }}'
interactive_disabled = '#{{ index $theme $s.interactive.disabled }}'

# Selection colors
selection_bg = '#{{ index $theme $s.selection.background }}'
selection_fg = '#{{ index $theme $s.selection.foreground }}'

# Border colors
border_default = '#{{ index $theme $s.border.default }}'

# Mode colors
mode_normal = '#{{ index $theme $s.mode.normal }}'
mode_insert = '#{{ index $theme $s.mode.insert }}'
mode_private = '#{{ index $theme $s.mode.private }}'
mode_passthrough = '#{{ index $theme $s.mode.passthrough }}'

# Accent colors
accent_link = '#{{ index $theme $s.accent.link }}'

# =============================================================================
# GENERAL SETTINGS
# =============================================================================

# Load autoconfig.yml (if it exists)
config.load_autoconfig(False)

# Downloads
c.downloads.location.directory = '~/Downloads'
c.downloads.location.prompt = False
c.downloads.remove_finished = 5000  # Remove from list after 5 seconds

# Content settings
c.content.autoplay = False
c.content.blocking.enabled = True
c.content.blocking.method = 'both'  # Use hosts files and adblock
c.content.blocking.adblock.lists = [
    'https://easylist.to/easylist/easylist.txt',
    'https://easylist.to/easylist/easyprivacy.txt',
]

# Prefer dark mode
c.colors.webpage.preferred_color_scheme = 'dark'
c.colors.webpage.darkmode.enabled = True
c.colors.webpage.darkmode.policy.images = 'never'

# Privacy & Security
c.content.cookies.accept = 'no-3rdparty'
c.content.headers.do_not_track = True
c.content.webrtc_ip_handling_policy = 'default-public-interface-only'

# Editor
c.editor.command = ['alacritty', '-e', 'hx', '{file}']

# Tabs
c.tabs.position = 'top'
c.tabs.show = 'multiple'
c.tabs.title.format = '{audio}{current_title}'
c.tabs.title.format_pinned = '{audio}'
c.tabs.last_close = 'close'
c.tabs.new_position.related = 'next'

# URL & Search
c.url.default_page = 'about:blank'
c.url.start_pages = ['about:blank']

# =============================================================================
# SEARCH ENGINES
# =============================================================================

c.url.searchengines = {
    'DEFAULT': 'https://duckduckgo.com/?q={}',
    'ddg': 'https://duckduckgo.com/?q={}',
    'g': 'https://www.google.com/search?q={}',
    'gh': 'https://github.com/search?q={}',
    'aw': 'https://wiki.archlinux.org/index.php?search={}',
    'aur': 'https://aur.archlinux.org/packages/?K={}',
    'yt': 'https://www.youtube.com/results?search_query={}',
    'wi': 'https://en.wikipedia.org/wiki/{}',
}

# =============================================================================
# THEME-AGNOSTIC SEMANTIC COLORS
# =============================================================================
# "Each color carries intention; each intention serves the whole"

# Completion widget
c.colors.completion.fg = text_primary
c.colors.completion.odd.bg = surface_primary
c.colors.completion.even.bg = surface_subtle
c.colors.completion.category.fg = interactive_focus  # Category headers
c.colors.completion.category.bg = surface_elevated
c.colors.completion.category.border.top = surface_elevated
c.colors.completion.category.border.bottom = surface_elevated
c.colors.completion.item.selected.fg = text_inverted
c.colors.completion.item.selected.bg = interactive_focus  # Selected item
c.colors.completion.item.selected.border.top = interactive_focus
c.colors.completion.item.selected.border.bottom = interactive_focus
c.colors.completion.item.selected.match.fg = state_warning  # Match highlighting
c.colors.completion.match.fg = state_warning
c.colors.completion.scrollbar.fg = interactive_focus
c.colors.completion.scrollbar.bg = surface_primary

# Context menu
c.colors.contextmenu.disabled.bg = surface_primary
c.colors.contextmenu.disabled.fg = text_disabled
c.colors.contextmenu.menu.bg = surface_primary
c.colors.contextmenu.menu.fg = text_primary
c.colors.contextmenu.selected.bg = interactive_focus
c.colors.contextmenu.selected.fg = text_inverted

# Downloads
c.colors.downloads.bar.bg = surface_primary
c.colors.downloads.start.fg = text_inverted
c.colors.downloads.start.bg = state_info  # Loading
c.colors.downloads.stop.fg = text_inverted
c.colors.downloads.stop.bg = state_success  # Complete
c.colors.downloads.error.fg = state_error

# Hints (link selection)
c.colors.hints.fg = text_inverted
c.colors.hints.bg = state_warning  # Attention-grabbing yellow
c.colors.hints.match.fg = text_emphasis

# Keyhint widget
c.colors.keyhint.fg = text_primary
c.colors.keyhint.suffix.fg = state_warning  # Key suffix highlighting
c.colors.keyhint.bg = surface_primary

# Messages
c.colors.messages.error.fg = state_error
c.colors.messages.error.bg = surface_primary
c.colors.messages.error.border = state_error
c.colors.messages.warning.fg = state_warning
c.colors.messages.warning.bg = surface_primary
c.colors.messages.warning.border = state_warning
c.colors.messages.info.fg = state_info
c.colors.messages.info.bg = surface_primary
c.colors.messages.info.border = state_info

# Prompts
c.colors.prompts.fg = text_primary
c.colors.prompts.bg = surface_primary
c.colors.prompts.border = interactive_focus
c.colors.prompts.selected.bg = surface_elevated
c.colors.prompts.selected.fg = text_primary

# Status bar (mode-aware semantic colors)
c.colors.statusbar.normal.fg = text_primary
c.colors.statusbar.normal.bg = surface_primary
c.colors.statusbar.insert.fg = text_inverted
c.colors.statusbar.insert.bg = mode_insert  # Insert mode
c.colors.statusbar.passthrough.fg = text_inverted
c.colors.statusbar.passthrough.bg = mode_passthrough  # Passthrough mode
c.colors.statusbar.private.fg = text_inverted
c.colors.statusbar.private.bg = mode_private  # Private mode
c.colors.statusbar.command.fg = text_primary
c.colors.statusbar.command.bg = surface_primary
c.colors.statusbar.command.private.fg = text_inverted
c.colors.statusbar.command.private.bg = mode_private
c.colors.statusbar.caret.fg = text_inverted
c.colors.statusbar.caret.bg = state_warning  # Caret mode
c.colors.statusbar.caret.selection.fg = text_inverted
c.colors.statusbar.caret.selection.bg = state_warning
c.colors.statusbar.progress.bg = interactive_focus  # Progress indicator
c.colors.statusbar.url.fg = text_primary
c.colors.statusbar.url.error.fg = state_error
c.colors.statusbar.url.hover.fg = interactive_focus
c.colors.statusbar.url.success.http.fg = state_warning  # HTTP (insecure)
c.colors.statusbar.url.success.https.fg = state_success  # HTTPS (secure)
c.colors.statusbar.url.warn.fg = state_warning

# Tabs
c.colors.tabs.bar.bg = surface_primary
c.colors.tabs.indicator.start = state_info  # Loading
c.colors.tabs.indicator.stop = state_success  # Complete
c.colors.tabs.indicator.error = state_error  # Error

# Unselected tabs
c.colors.tabs.odd.fg = text_secondary
c.colors.tabs.odd.bg = surface_primary
c.colors.tabs.even.fg = text_secondary
c.colors.tabs.even.bg = surface_subtle

# Selected tab
c.colors.tabs.selected.odd.fg = text_emphasis
c.colors.tabs.selected.odd.bg = surface_elevated
c.colors.tabs.selected.even.fg = text_emphasis
c.colors.tabs.selected.even.bg = surface_elevated

# Pinned tabs
c.colors.tabs.pinned.odd.fg = text_secondary
c.colors.tabs.pinned.odd.bg = surface_primary
c.colors.tabs.pinned.even.fg = text_secondary
c.colors.tabs.pinned.even.bg = surface_subtle
c.colors.tabs.pinned.selected.odd.fg = interactive_focus  # Pinned + selected
c.colors.tabs.pinned.selected.odd.bg = surface_elevated
c.colors.tabs.pinned.selected.even.fg = interactive_focus
c.colors.tabs.pinned.selected.even.bg = surface_elevated

# =============================================================================
# HELIX-NATIVE KEYBINDINGS
# =============================================================================
# "Each key carries semantic intention; muscle memory flows universally"

# Clear default bindings we're replacing
config.unbind('G', mode='normal')  # We use 'ge' instead (Helix-native)

# Navigation (Helix-native philosophy)
config.bind('ge', 'scroll-page 0 1', mode='normal')  # Go to end (not G)
config.bind('gg', 'scroll-page 0 0', mode='normal')  # Go to start
config.bind('gh', 'scroll-to-perc 0', mode='normal')  # Go home (line start concept)
config.bind('gl', 'scroll-to-perc 100', mode='normal')  # Go line end concept

# Smooth scrolling (j/k for small movements)
config.bind('j', 'scroll down', mode='normal')
config.bind('k', 'scroll up', mode='normal')
config.bind('h', 'scroll left', mode='normal')
config.bind('l', 'scroll right', mode='normal')

# Half-page scrolling (d/u like Helix)
config.bind('d', 'scroll-page 0 0.5', mode='normal')
config.bind('u', 'scroll-page 0 -0.5', mode='normal')

# Tab navigation (J/K for prev/next)
config.bind('J', 'tab-prev', mode='normal')
config.bind('K', 'tab-next', mode='normal')
config.bind('gT', 'tab-prev', mode='normal')  # Alternative
config.bind('gt', 'tab-next', mode='normal')  # Alternative

# Tab manipulation
config.bind('gn', 'tab-next', mode='normal')
config.bind('gp', 'tab-prev', mode='normal')
config.bind('gc', 'tab-close', mode='normal')
config.bind('gf', 'tab-focus', mode='normal')
config.bind('gm', 'tab-move', mode='normal')

# History navigation
config.bind('H', 'back', mode='normal')
config.bind('L', 'forward', mode='normal')

# Hints (link following)
config.bind('f', 'hint links', mode='normal')
config.bind('F', 'hint links tab-bg', mode='normal')
config.bind(';y', 'hint links yank', mode='normal')
config.bind(';Y', 'hint links yank-primary', mode='normal')

# Search
config.bind('/', 'set-cmd-text /', mode='normal')
config.bind('?', 'set-cmd-text ?', mode='normal')
config.bind('n', 'search-next', mode='normal')
config.bind('N', 'search-prev', mode='normal')

# Zoom
config.bind('+', 'zoom-in', mode='normal')
config.bind('-', 'zoom-out', mode='normal')
config.bind('=', 'zoom', mode='normal')

# Quit/Close
config.bind('q', 'tab-close', mode='normal')
config.bind('Q', 'quit', mode='normal')

# =============================================================================
# CUSTOM INTEGRATIONS
# =============================================================================
# "Tools flow together; each enhances the whole"

# MPV integration (play video with mpv)
config.bind(',m', 'spawn mpv {url}', mode='normal')
config.bind(',M', 'hint links spawn mpv {hint-url}', mode='normal')

# Yank URL/Title
config.bind('yy', 'yank', mode='normal')
config.bind('yt', 'yank title', mode='normal')
config.bind('yd', 'yank domain', mode='normal')
config.bind('yp', 'yank pretty-url', mode='normal')

# Quick commands (comma prefix for custom actions)
config.bind(',r', 'reload', mode='normal')
config.bind(',R', 'reload --force', mode='normal')
config.bind(',p', 'open -p', mode='normal')  # Private window

# Reader mode
config.bind(',a', 'readability', mode='normal')

# =============================================================================
# FONTS
# =============================================================================

c.fonts.default_family = 'monospace'
c.fonts.default_size = '10pt'
c.fonts.completion.entry = '10pt monospace'
c.fonts.completion.category = 'bold 10pt monospace'
c.fonts.statusbar = '10pt monospace'
c.fonts.tabs.selected = '10pt monospace'
c.fonts.tabs.unselected = '10pt monospace'
c.fonts.hints = 'bold 12pt monospace'
c.fonts.keyhint = '10pt monospace'
c.fonts.messages.error = '10pt monospace'
c.fonts.messages.info = '10pt monospace'
c.fonts.messages.warning = '10pt monospace'
c.fonts.prompts = '10pt monospace'
c.fonts.web.family.standard = 'sans-serif'
c.fonts.web.family.serif = 'serif'
c.fonts.web.family.sans_serif = 'sans-serif'
c.fonts.web.family.fixed = 'monospace'

# =============================================================================
# ALIASES
# =============================================================================

c.aliases = {
    'w': 'session-save',
    'wq': 'quit --save',
    'q': 'tab-close',
    'qa': 'quit',
    'h': 'help',
}

# =============================================================================
# AUTO-SAVE SESSION
# =============================================================================

c.auto_save.session = True
{{- /* Remove all torrents and clean incomplete directory */ -}}
function tpurge --description "Remove all torrents and clean incomplete files"
    if not systemctl --user is-active --quiet transmission-daemon
        echo "⚠ Transmission daemon not running"
        return 1
    end

    # Confirm action
    echo -n "This will remove ALL torrents and incomplete files. Continue? [y/N] "
    read -l confirm

    if test "$confirm" != "y"
        echo "Cancelled"
        return 0
    end

    # Remove all torrents
    transmission-remote {{ .transmission.rpc_host }}:{{ .transmission.rpc_port }} -n (transmission-auth) -t all --remove-and-delete >/dev/null 2>&1

    # Clean incomplete directory
    if test -d "{{ .chezmoi.homeDir }}/Videos/.incomplete"
        rm -rf "{{ .chezmoi.homeDir }}/Videos/.incomplete/"* 2>/dev/null
    end

    set_color green
    echo "✓ All torrents removed and incomplete files cleaned"
    set_color normal
end
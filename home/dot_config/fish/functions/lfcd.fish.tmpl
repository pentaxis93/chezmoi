{{- $selection := .kanagawa.dragon.selection -}}
{{- $green := .kanagawa.dragon.green -}}
{{- $comment := .kanagawa.dragon.bright_black -}}
{{- /* Convert hex to RGB values */ -}}
{{- $sel_r := printf "0x%s" (substr 0 2 $selection) | atoi -}}
{{- $sel_g := printf "0x%s" (substr 2 4 $selection) | atoi -}}
{{- $sel_b := printf "0x%s" (substr 4 6 $selection) | atoi -}}
{{- $grn_r := printf "0x%s" (substr 0 2 $green) | atoi -}}
{{- $grn_g := printf "0x%s" (substr 2 4 $green) | atoi -}}
{{- $grn_b := printf "0x%s" (substr 4 6 $green) | atoi -}}
{{- $com_r := printf "0x%s" (substr 0 2 $comment) | atoi -}}
{{- $com_g := printf "0x%s" (substr 2 4 $comment) | atoi -}}
{{- $com_b := printf "0x%s" (substr 4 6 $comment) | atoi -}}
function lfcd --description 'lf with directory change on exit'
    # Ultra-Zen: "Navigate through directories, emerge in a new place"

    set tmp (mktemp)
    set fid (random)

    # Start lf with last dir printing
    if count $argv > /dev/null
        command lf -last-dir-path="$tmp" -command "set promptfmt \"\\033[38;2;{{ $sel_r }};{{ $sel_g }};{{ $sel_b }}m lf\\033[0m:\\033[38;2;{{ $grn_r }};{{ $grn_g }};{{ $grn_b }}m %w\\033[0m\\033[38;2;{{ $com_r }};{{ $com_g }};{{ $com_b }}m/%f\\033[0m\"" $argv
    else
        command lf -last-dir-path="$tmp" -command "set promptfmt \"\\033[38;2;{{ $sel_r }};{{ $sel_g }};{{ $sel_b }}m lf\\033[0m:\\033[38;2;{{ $grn_r }};{{ $grn_g }};{{ $grn_b }}m %w\\033[0m\\033[38;2;{{ $com_r }};{{ $com_g }};{{ $com_b }}m/%f\\033[0m\""
    end

    set ret $status

    if test -f "$tmp"
        set dir (cat "$tmp")
        rm -f "$tmp"
        if test -d "$dir"
            if test "$dir" != (pwd)
                cd "$dir"
            end
        end
    end

    return $ret
end

# Create semantic abbreviation
abbr -a lc lfcd  # (l)f (c)hange directory
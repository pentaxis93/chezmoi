# Ultra-Zen ZFS Snapshot Timeline
# "Behold the layers of time, preserved in perfect stillness"

function zlist --description "List ZFS snapshots with details"
    set -l dataset $argv[1]

    if test -z "$dataset"
        # Show all snapshots across all datasets
        echo "{{ template "color-hex.tmpl" .themes.kanagawa.dragon.blue }}═══ All Snapshots ═══{{ template "color-hex.tmpl" .themes.kanagawa.dragon.white }}"
        echo
        zfs list -t snapshot -o name,used,refer,creation -s creation
    else
        # Verify dataset exists
        if not zfs list $dataset &>/dev/null
            echo "{{ template "color-hex.tmpl" .themes.kanagawa.dragon.red }}✗{{ template "color-hex.tmpl" .themes.kanagawa.dragon.white }} Dataset does not exist: $dataset"
            return 1
        end

        # Show snapshots for specific dataset
        echo "{{ template "color-hex.tmpl" .themes.kanagawa.dragon.blue }}═══ Snapshots for $dataset ═══{{ template "color-hex.tmpl" .themes.kanagawa.dragon.white }}"
        echo
        zfs list -t snapshot -o name,used,refer,creation -s creation -r $dataset
    end
end

# Ultra-Zen ZFS Snapshot Creation
# "Capture this moment; let time flow from here"

function zsnap --description "Create ZFS snapshot with semantic name"
    # Check arguments
    if test (count $argv) -ne 2
        echo "{{ template "color-hex.tmpl" .themes.kanagawa.dragon.blue }}Usage:{{ template "color-hex.tmpl" .themes.kanagawa.dragon.white }} zsnap <dataset> <name>"
        echo "{{ template "color-hex.tmpl" .themes.kanagawa.dragon.blue }}Example:{{ template "color-hex.tmpl" .themes.kanagawa.dragon.white }} zsnap zpcachyos/ROOT/cos/home before-cleanup"
        return 1
    end

    set -l dataset $argv[1]
    set -l name $argv[2]
    set -l snapshot "$dataset@$name"

    # Verify dataset exists
    if not zfs list $dataset &>/dev/null
        echo "{{ template "color-hex.tmpl" .themes.kanagawa.dragon.red }}✗{{ template "color-hex.tmpl" .themes.kanagawa.dragon.white }} Dataset does not exist: $dataset"
        return 1
    end

    # Show what will be created
    echo "{{ template "color-hex.tmpl" .themes.kanagawa.dragon.blue }}Creating snapshot:{{ template "color-hex.tmpl" .themes.kanagawa.dragon.white }} $snapshot"

    # Create snapshot
    if zfs snapshot $snapshot
        echo "{{ template "color-hex.tmpl" .themes.kanagawa.dragon.green }}✓{{ template "color-hex.tmpl" .themes.kanagawa.dragon.white }} Snapshot created: $snapshot"
        echo "{{ template "color-hex.tmpl" .themes.kanagawa.dragon.bright_black }}  Access via: /.zfs/snapshot/$name/{{ template "color-hex.tmpl" .themes.kanagawa.dragon.white }}"
    else
        echo "{{ template "color-hex.tmpl" .themes.kanagawa.dragon.red }}✗{{ template "color-hex.tmpl" .themes.kanagawa.dragon.white }} Failed to create snapshot"
        return 1
    end
end

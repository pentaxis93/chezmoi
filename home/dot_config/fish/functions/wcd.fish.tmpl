{{- /* WeeChat downloads management function */ -}}
function wcd --description "Manage WeeChat downloads (weechat-downloads)"
    # Ultra-Zen: Mindful management of received files

    # Parse subcommands
    switch $argv[1]
        case list l
            # List recent downloads
            echo "Recent downloads (last 7 days):"
            echo "================================"
            if test -d ~/Downloads
                set -l files (find ~/Downloads -type f -mtime -7 2>/dev/null | sort -r)
                if test -n "$files"
                    for file in $files
                        set -l size (du -h "$file" 2>/dev/null | cut -f1)
                        set -l date (date -r "$file" "+%Y-%m-%d %H:%M" 2>/dev/null)
                        echo "$date  $size  "(basename "$file")
                    end
                else
                    echo "No recent downloads found"
                end
            else
                echo "Downloads directory does not exist"
            end

        case clean c
            # Clean old downloads
            echo "Cleaning downloads older than 30 days..."
            if test -d ~/Downloads
                set -l old_files (find ~/Downloads -type f -mtime +30 2>/dev/null)
                if test -n "$old_files"
                    set -l count (echo "$old_files" | wc -l)
                    echo "Found $count old files:"
                    for file in $old_files
                        echo "  • "(basename "$file")
                    end
                    echo ""
                    read -P "Remove these files? [y/N] " confirm
                    if test "$confirm" = "y" -o "$confirm" = "Y"
                        for file in $old_files
                            rm -f "$file"
                        end
                        echo "✓ Removed $count old files"
                    else
                        echo "✗ Cleanup cancelled"
                    end
                else
                    echo "No old files to clean"
                end
            end

        case open o
            # Open downloads directory
            if test -d ~/Downloads
                if command -q xdg-open
                    xdg-open ~/Downloads
                else if command -q open
                    open ~/Downloads
                else
                    echo "Opening ~/Downloads in file manager..."
                    cd ~/Downloads
                end
            else
                echo "Downloads directory does not exist"
            end

        case '*'
            # Show help
            echo "WeeChat downloads management"
            echo ""
            echo "Usage: wcd [command]"
            echo ""
            echo "Commands:"
            echo "  list, l    - List recent downloads (last 7 days)"
            echo "  clean, c   - Clean old downloads (>30 days)"
            echo "  open, o    - Open downloads directory"
            echo ""
            echo "Downloads directory: ~/Downloads"
            echo "DCC auto-accept limit: 10MB"
    end
end
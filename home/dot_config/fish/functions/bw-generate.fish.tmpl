# Ultra-Zen Password Generation
# "From chaos emerges cryptographic harmony"

function bw-generate --description "Generate secure password with semantic options"
    # Parse arguments with semantic defaults
    set -l length 32        # Default: Strong security
    set -l uppercase true
    set -l lowercase true
    set -l numbers true
    set -l special true
    set -l copy false

    # Process arguments
    for arg in $argv
        switch $arg
            case --simple
                # Simple passwords: no special characters
                set special false
                set length 20
            case --strong
                # Maximum security (default)
                set length 32
            case --pin
                # Numeric PIN only
                set uppercase false
                set lowercase false
                set special false
                set length 6
            case --passphrase
                # Generate passphrase instead
                bw generate --passphrase --words 4 --separator "-"
                return
            case --copy -c
                set copy true
            case '--length=*'
                set length (string replace '--length=' '' $arg)
            case '*'
                if string match -qr '^\d+$' $arg
                    set length $arg
                end
        end
    end

    # Build generation command
    set -l gen_args
    if test $uppercase = false
        set gen_args $gen_args --uppercase false
    end
    if test $lowercase = false
        set gen_args $gen_args --lowercase false
    end
    if test $numbers = false
        set gen_args $gen_args --number false
    end
    if test $special = false
        set gen_args $gen_args --special false
    end

    # Generate password
    set -l password (bw generate --length $length $gen_args 2>/dev/null)

    if test -n "$password"
        if test $copy = true
            # Copy to clipboard
            if type -q wl-copy
                echo -n $password | wl-copy
                echo "{{ template "color-hex.tmpl" .themes.kanagawa.dragon.green }}✓{{ template "color-hex.tmpl" .themes.kanagawa.dragon.white }} Generated password copied to clipboard"
            else
                echo "{{ template "color-hex.tmpl" .themes.kanagawa.dragon.red }}✗{{ template "color-hex.tmpl" .themes.kanagawa.dragon.white }} No clipboard manager found (install wl-clipboard)"
                return 1
            end
        else
            # Display password
            echo "{{ template "color-hex.tmpl" .themes.kanagawa.dragon.green }}✓{{ template "color-hex.tmpl" .themes.kanagawa.dragon.white }} Generated password:"
            echo "{{ template "color-hex.tmpl" .themes.kanagawa.dragon.bright_cyan }}$password{{ template "color-hex.tmpl" .themes.kanagawa.dragon.white }}"
        end
    else
        echo "{{ template "color-hex.tmpl" .themes.kanagawa.dragon.red }}✗{{ template "color-hex.tmpl" .themes.kanagawa.dragon.white }} Failed to generate password"
        return 1
    end
end